<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bluff Masters</title>
<link rel="icon" href="blufffavicon.png" />
<style>
/* ðŸ”’ STYLES UNCHANGED */
</style>
</head>
<body>
<!-- ðŸ”’ HTML UNCHANGED ABOVE -->

<script type="module">
/* ================================
   ðŸ”’ ORIGINAL CODE UNCHANGED
   âž• ONLY ADDITIONS BELOW
================================ */

const ORIGINAL_TEAM_LIST = [...TEAM_LIST];

/* ========= 1ï¸âƒ£ START NEW SERIES (FIXED) ========= */
window.startNewSeries = function(){
  const teamOptions = TEAM_LIST.map(t=>`<option value="${escapeHtml(t)}">${escapeHtml(t)}</option>`).join("");
  const inner = `
    <div>
      <label>Series target</label>
      <select id="modalSeriesTarget" style="width:100%;padding:8px;margin-top:6px">
        <option value="5">First to 5</option>
        <option value="10">First to 10</option>
      </select>

      <label style="margin-top:10px;display:block">Team A</label>
      <select id="modalTeamA" style="width:100%;padding:8px;margin-top:6px">${teamOptions}</select>
      <input id="customTeamA" placeholder="Or enter custom name"
        style="width:100%;padding:8px;margin-top:6px"/>

      <label style="margin-top:10px;display:block">Team B</label>
      <select id="modalTeamB" style="width:100%;padding:8px;margin-top:6px">${teamOptions}</select>
      <input id="customTeamB" placeholder="Or enter custom name"
        style="width:100%;padding:8px;margin-top:6px"/>
    </div>
  `;
  showModalBox("Start New Series", inner, "Start", ()=>{
    const target = +document.getElementById("modalSeriesTarget").value || 5;
    const teamA = document.getElementById("customTeamA").value.trim() || document.getElementById("modalTeamA").value;
    const teamB = document.getElementById("customTeamB").value.trim() || document.getElementById("modalTeamB").value;

    if(!teamA || !teamB) return alert("Both teams required");
    if(teamA === teamB) return alert("Teams must be different");

    const sid = uid("series");
    const meta = {
      seriesId: sid,
      seriesTarget: target,
      seriesStartedAt: new Date().toISOString(),
      time: new Date().toISOString(),
      _metaOnly: true
    };
    gameData.games.push(meta);
    saveLocal();
    renderHomeActiveList();
  });
};

/* ========= 2ï¸âƒ£ EDIT PLAYERS IN ACTIVE SERIES ========= */
function editSeriesTeams(seriesId){
  const pw = prompt("Enter password to edit teams:");
  if(pw !== SECRET_KEY) return alert("âŒ Incorrect password");

  const games = gameData.games.filter(g=>g.seriesId===seriesId && g.winner);
  if(!games.length) return alert("No games yet to edit teams");

  const teams = Array.from(new Set(games.flatMap(g=>[g.winner,g.loser])));
  const updated = prompt("Edit teams (comma separated):", teams.join(", "));
  if(!updated) return;

  const [newA,newB] = updated.split(",").map(t=>t.trim());
  if(!newA || !newB) return alert("Need two team names");

  games.forEach(g=>{
    g.winner = g.winner===teams[0]?newA:newB;
    g.loser = g.loser===teams[0]?newA:newB;
  });

  saveLocal();
  renderHomeActiveList();
  updateStatsUI();
}

/* ========= Inject Edit Button (non-invasive) ========= */
const originalRender = renderHomeActiveList;
renderHomeActiveList = function(){
  originalRender();
  document.querySelectorAll(".series-card").forEach(card=>{
    if(card.querySelector(".edit-btn")) return;
    const btn = document.createElement("button");
    btn.className = "neu-btn secondary edit-btn";
    btn.textContent = "âœï¸ Edit";
    btn.onclick = ()=>{
      const sid = card.querySelector(".trash").onclick.toString().match(/'(series_[^']+)'/)[1];
      editSeriesTeams(sid);
    };
    card.querySelector(".right-controls").appendChild(btn);
  });
};

</script>
</body>
</html>
