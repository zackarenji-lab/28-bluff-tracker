<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bluff Masters</title>

<style>
:root{
  --color-primary:#2ecc71;
  --color-dark:#ecf0f1;
}
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  background:radial-gradient(circle at top,#1e335f,#000814 65%,#111 100%);
  color:var(--color-dark);
  padding:20px;min-height:100vh;
}
.container{max-width:900px;margin:auto}
.card{backdrop-filter:blur(10px);background:rgba(255,255,255,0.05);border-radius:14px;padding:20px;margin-bottom:16px;border:1px solid rgba(255,255,255,0.06)}
.top-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
.header h1{margin:0;font-size:1.6rem}
.btn{width:100%;padding:12px;border-radius:10px;border:none;font-weight:700;cursor:pointer;margin:8px 0}
.btn-primary{background:var(--color-primary);color:#051011}
.btn-primary:hover{box-shadow:0 0 12px rgba(46,204,113,0.9);transform:translateY(-2px)}
.btn-secondary{background:#444;color:white}
.home-image{width:100%;border-radius:12px;margin-bottom:14px;opacity:0;animation:fadeIn 1s forwards}
@keyframes fadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}

.team-item{background:rgba(0,0,0,0.45);padding:12px;border-radius:10px;margin:8px 0;border:1px solid rgba(255,255,255,0.06)}
.metric-row{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-top:6px}
.metric-box{background:rgba(255,255,255,0.03);padding:8px;border-radius:8px;text-align:center;border:1px solid rgba(255,255,255,0.05)}
.bar-graph{height:8px;width:100%;background:#111;border-radius:6px;overflow:hidden;display:flex;margin-top:8px}
.bar-wins{background:#2ecc71;transition:width 1s ease}
.bar-losses{background:#e74c3c;transition:width 1s ease}

.champion-team{border:2px solid gold;animation:glow 2.2s infinite;position:relative}
.champion-team::before{content:"üëë";position:absolute;top:-10px;right:-10px;font-size:1.4rem}
@keyframes glow{0%{box-shadow:0 0 6px gold}50%{box-shadow:0 0 20px gold}100%{box-shadow:0 0 6px gold}}

.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.75);display:flex;align-items:center;justify-content:center;z-index:9999}
.confirm-box{background:#0f1720;padding:30px;border-radius:12px;color:#ddd;max-width:420px;text-align:center}
.small-muted{font-size:0.8rem;color:#9aa6ad;margin-top:10px}
</style>
</head>
<body>
<div class="container">
  <div class="top-row">
    <div class="header">
      <h1>Bluff Masters</h1>
      <div style="color:#cdd8e2;font-size:0.95rem">Track wins, series & stats</div>
    </div>
    <button id="homeBtn" class="btn btn-secondary" style="display:none" onclick="goHome()">üè† Home</button>
  </div>

  <!-- HOME -->
  <div id="homeScreen" class="screen active">
    <div class="card" style="text-align:center">
      <img src="bluffmasters.png" class="home-image" onerror="console.warn('Image not found: bluffmasters.png')" />
      <h2 style="margin:10px 0 12px 0">Welcome</h2>
      <button class="btn btn-primary" onclick="startNewGame()">‚ûï New Game</button>
      <button class="btn btn-secondary" onclick="showStats()">üìä View Statistics</button>
    </div>
  </div>

  <!-- Game Type -->
  <div id="gameTypeScreen" class="screen" style="display:none">
    <div class="card">
      <h2>Select Series</h2>
      <button class="btn btn-primary" onclick="selectGameType(5)">5 Game Series</button>
      <button class="btn btn-primary" onclick="selectGameType(10)">10 Game Series</button>
      <button class="btn btn-secondary" onclick="goHome()">‚Üê Back</button>
    </div>
  </div>

  <!-- Winner -->
  <div id="winnerScreen" class="screen" style="display:none">
    <div class="card">
      <h2>Who Won?</h2>
      <button class="btn btn-primary" onclick="selectTeam('winner','Bibin & Zach')">Bibin & Zach</button>
      <button class="btn btn-primary" onclick="selectTeam('winner','Bimal & Annu')">Bimal & Annu</button>
      <button class="btn btn-primary" onclick="selectTeam('winner','Bibin & Annu')">Bibin & Annu</button>
      <button class="btn btn-primary" onclick="selectTeam('winner','Zach & Daddy')">Zach & Daddy</button>
      <button class="btn btn-primary" onclick="selectTeam('winner','Bibin & Bimal')">Bibin & Bimal</button>
      <button class="btn btn-primary" onclick="selectTeam('winner','Zach & Rikku')">Zach & Rikku</button>
      <button class="btn btn-primary" onclick="selectTeam('winner','Bibin & Daddy')">Bibin & Daddy</button>
    </div>
  </div>

  <!-- Loser -->
  <div id="loserScreen" class="screen" style="display:none">
    <div class="card">
      <h2>Who Lost?</h2>
      <button class="btn btn-secondary" onclick="selectTeam('loser','Bibin & Zach')">Bibin & Zach</button>
      <button class="btn btn-secondary" onclick="selectTeam('loser','Bimal & Annu')">Bimal & Annu</button>
      <button class="btn btn-secondary" onclick="selectTeam('loser','Bibin & Annu')">Bibin & Annu</button>
      <button class="btn btn-secondary" onclick="selectTeam('loser','Zach & Daddy')">Zach & Daddy</button>
      <button class="btn btn-secondary" onclick="selectTeam('loser','Bibin & Bimal')">Bibin & Bimal</button>
      <button class="btn btn-secondary" onclick="selectTeam('loser','Zach & Rikku')">Zach & Rikku</button>
      <button class="btn btn-secondary" onclick="selectTeam('loser','Bibin & Daddy')">Bibin & Daddy</button>
    </div>
  </div>

  <!-- Stats -->
  <div id="statsScreen" class="screen" style="display:none">
    <div class="card">
      <h2>Overall Statistics</h2>

      <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:10px">
        <div style="background:linear-gradient(135deg,#3affd0,#20a56e);padding:12px;border-radius:8px;text-align:center;font-weight:700;color:#07130f">
          <div>Total Games</div><div id="totalGames">0</div>
        </div>
        <div style="background:linear-gradient(135deg,#6ec0ff,#4a7bd6);padding:12px;border-radius:8px;text-align:center;font-weight:700;color:#07130f">
          <div>Total Series</div><div id="totalSeries">0</div>
        </div>
      </div>

      <div id="teamStats" style="margin-top:12px"></div>

      <h3 style="margin-top:14px">Game History</h3>
      <div id="gameHistory"></div>

      <div style="margin-top:12px">
        <button class="btn btn-primary" onclick="shareToWhatsApp()">üì§ Share</button>
        <button class="btn btn-secondary" onclick="goHome()">‚Üê Back</button>
      </div>

      <!-- small delete-last-game link -->
      <div style="text-align:center; margin-top:10px;">
        <span style="font-size:0.75rem; opacity:0.7; cursor:pointer; text-decoration:underline;"
              onclick="deleteLastGame()">
          Delete last game
        </span>
      </div>

      <!-- small reset-all link -->
      <div style="text-align:center; margin-top:6px;">
        <span style="font-size:0.7rem; opacity:0.7; cursor:pointer; text-decoration:underline;"
              onclick="resetStats()">
          Reset all statistics
        </span>
      </div>
    </div>
  </div>
</div>

<script>
let currentGame={};
let gameData={games:[],teamStats:{}};
const STORAGE_KEY='bluff_tracker_v1';
const sound=new Audio('ding.mp3');

(function init(){
  const raw=localStorage.getItem(STORAGE_KEY);
  if(raw) gameData=JSON.parse(raw);
})();

function saveData(){localStorage.setItem(STORAGE_KEY,JSON.stringify(gameData));}
function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.style.display='none');
  document.getElementById(id).style.display='block';
  document.getElementById('homeBtn').style.display=(id==='homeScreen')?'none':'inline-block';
}
function goHome(){showScreen('homeScreen');}

function startNewGame(){currentGame={};showScreen('gameTypeScreen');}
function selectGameType(t){currentGame.gameType=t;showScreen('winnerScreen');}

function selectTeam(role,team){
  if(role==='winner'){currentGame.winner=team;showScreen('loserScreen');}
  else{
    if(!currentGame.winner){alert('Pick winner first');return;}
    if(team===currentGame.winner){alert('Winner and loser cannot be same');return;}
    currentGame.loser=team;saveGame();
  }
}

function saveGame(){
  currentGame.date=new Date().toISOString();
  gameData.games.push({...currentGame});

  if(!gameData.teamStats[currentGame.winner]) gameData.teamStats[currentGame.winner]={wins:0,losses:0,seriesWon:0};
  if(!gameData.teamStats[currentGame.loser]) gameData.teamStats[currentGame.loser]={wins:0,losses:0,seriesWon:0};

  gameData.teamStats[currentGame.winner].wins++;
  gameData.teamStats[currentGame.loser].losses++;

  try{sound.currentTime=0;sound.play();}catch(e){}

  saveData();
  showConfirmation("‚úÖ Game Saved",`${currentGame.winner} beat ${currentGame.loser}`,()=>{
    simpleConfetti();
    showStats();
  });
  currentGame={};
}

/* simple confetti */
function simpleConfetti(){
  const canvas=document.createElement('canvas');
  canvas.style.position='fixed';canvas.style.left=0;canvas.style.top=0;
  canvas.style.width='100%';canvas.style.height='100%';
  canvas.style.zIndex=99998;canvas.style.pointerEvents='none';
  document.body.appendChild(canvas);
  const ctx=canvas.getContext('2d');
  function resize(){canvas.width=innerWidth;canvas.height=innerHeight;}
  resize();window.addEventListener('resize',resize);
  const colors=['#ffdd57','#ff6b6b','#44ff8a','#6ec0ff','#ff9ce3'];
  const p=[];
  for(let i=0;i<70;i++){
    p.push({x:Math.random()*canvas.width,y:-Math.random()*canvas.height,
    w:6+Math.random()*10,h:6+Math.random()*10,
    vx:-2+Math.random()*4,vy:2+Math.random()*4,
    color:colors[Math.floor(Math.random()*colors.length)],
    rot:Math.random()*360,vr:-5+Math.random()*10});
  }
  let last=performance.now();
  function frame(t){
    const dt=(t-last)/16.67;last=t;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    p.forEach(a=>{
      a.x+=a.vx*dt;a.y+=a.vy*dt;a.vy+=0.05*dt;a.rot+=a.vr*dt;
      ctx.save();ctx.translate(a.x,a.y);ctx.rotate(a.rot*Math.PI/180);
      ctx.fillStyle=a.color;ctx.fillRect(-a.w/2,-a.h/2,a.w,a.h);ctx.restore();
    });
    if(p.every(a=>a.y>canvas.height+50)){
      window.removeEventListener('resize',resize);
      canvas.remove();return;
    }
    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);
}

/* confirmation popup */
let modalRef=null;
function showConfirmation(title,msg,onOk){
  closeModal();
  const overlay=document.createElement('div');overlay.className='overlay';
  const box=document.createElement('div');box.className='confirm-box';
  box.innerHTML=`<h2>${title}</h2><div style="margin-bottom:12px">${msg}</div>`;
  const btn=document.createElement('button');btn.className='btn btn-primary';
  btn.innerText='OK';btn.onclick=function(){closeModal();if(onOk)onOk();};
  box.appendChild(btn);
  box.appendChild(Object.assign(document.createElement('div'),{className:'small-muted',innerText:'Saved in browser storage.'}));
  overlay.appendChild(box);document.body.appendChild(overlay);modalRef=overlay;
}
function closeModal(){if(modalRef){modalRef.remove();modalRef=null;}}

/* stats screen */
function showStats(){
  document.getElementById('totalGames').textContent=gameData.games.length;
  document.getElementById('totalSeries').textContent=Object.values(gameData.teamStats).reduce((a,b)=>a+(b.seriesWon||0),0);

  const t=Object.keys(gameData.teamStats).sort((a,b)=>(gameData.teamStats[b].wins||0)-(gameData.teamStats[a].wins||0));
  let html='';
  t.forEach((team,i)=>{
    const s=gameData.teamStats[team],w=s.wins||0,l=s.losses||0,total=w+l,wp=total?Math.round((w/total)*100):0,lp=100-wp;
    html+=`
    <div class="team-item ${i===0?'champion-team':''}">
      <div class="team-name">${team}</div>
      <div class="metric-row">
        <div class="metric-box"><div class="metric-label">Wins</div><div class="metric-value">${w}</div></div>
        <div class="metric-box"><div class="metric-label">Losses</div><div class="metric-value">${l}</div></div>
        <div class="metric-box"><div class="metric-label">Series</div><div class="metric-value">${s.seriesWon||0}</div></div>
        <div class="metric-box"><div class="metric-label">Win %</div><div class="metric-value">${wp}</div></div>
      </div>
      <div class="bar-graph"><div class="bar-wins" style="width:${wp}%"></div><div class="bar-losses" style="width:${lp}%"></div></div>
    </div>`;
  });
  document.getElementById('teamStats').innerHTML=html||'<div style="color:#cfd8e3">No teams yet</div>';

  const hist=gameData.games.slice().reverse().map(g=>{
    const d=new Date(g.date).toLocaleString();
    return `
    <div style="background:rgba(255,255,255,0.06);padding:10px;margin:8px 0;border-radius:10px;">
      <small>${d}</small><br><b>${g.winner}</b> beat <b>${g.loser}</b>
    </div>`;
  }).join('');
  document.getElementById('gameHistory').innerHTML=hist||'<div style="color:#cfd8e3">No games yet</div>';

  showScreen('statsScreen');
}

/* delete only the last game */
function deleteLastGame(){
  if(gameData.games.length===0){alert("No games to delete.");return;}

  const pw=prompt("Enter password to delete last game:");
  if(pw!=="zachariahrenji"){alert("‚ùå Incorrect password");return;}

  if(!confirm("Delete the most recent game permanently?"))return;

  const g=gameData.games[gameData.games.length-1];
  if(gameData.teamStats[g.winner] && gameData.teamStats[g.winner].wins>0) gameData.teamStats[g.winner].wins--;
  if(gameData.teamStats[g.loser] && gameData.teamStats[g.loser].losses>0) gameData.teamStats[g.loser].losses--;

  gameData.games.pop();

  Object.keys(gameData.teamStats).forEach(t=>{
    const s=gameData.teamStats[t];
    if((s.wins||0)+(s.losses||0)+(s.seriesWon||0)===0) delete gameData.teamStats[t];
  });

  saveData();
  showConfirmation("‚úÖ Last Game Deleted","Statistics updated.",()=>showStats());
}

/* reset all stats */
function resetStats(){
  const pw=prompt("Enter password to reset all data:");
  if(pw!=="zachariahrenji"){alert("‚ùå Incorrect password");return;}

  if(!confirm("‚ö†Ô∏è This will permanently delete ALL stats. Continue?"))return;

  localStorage.removeItem(STORAGE_KEY);
  gameData={games:[],teamStats:{}};
  showConfirmation("‚úÖ Reset Complete","All statistics erased.",()=>showStats());
}

/* WhatsApp share */
function shareToWhatsApp(){
  let msg=`üé¥ Bluff Masters ‚Äî Stats\nTotal Games: ${gameData.games.length}\n\n`;
  Object.keys(gameData.teamStats).forEach(t=>{
    const s=gameData.teamStats[t];
    msg+=`${t} ‚Äî W:${s.wins||0} L:${s.losses||0} S:${s.seriesWon||0}\n`;
  });
  const url='https://api.whatsapp.com/send?text='+encodeURIComponent(msg);
  window.open(url,'_blank');
}

console.log("‚úÖ Bluff Masters loaded. Make sure bluffmasters.png and ding.mp3 are uploaded.");
</script>
</body>
</html>
