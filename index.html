<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bluff Masters</title>
<link rel="icon" href="blufffavicon.png" />
<style>
/* ====== EXISTING STYLES (UNCHANGED) ====== */
:root{
  --bg1:#061226;--bg2:#081b31;--card:#0e2336;--muted:#9fb7bf;
  --accent:#2ecc71;--gold:#ffd36d;--danger:#ff6b6b;
}
html,body{height:100%;margin:0;font-family:Inter,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
background:radial-gradient(circle at 10% 10%,var(--bg1),var(--bg2) 60%);
color:#e6eef3;}
.wrap{max-width:1100px;margin:22px auto;padding:20px;}
header{display:flex;align-items:center;gap:18px;margin-bottom:18px}
.logo{width:62px;height:62px;border-radius:12px;background:linear-gradient(135deg,#ff6b6b,#ffd36d);
display:flex;align-items:center;justify-content:center;font-weight:800;color:#07111a;}
.card{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(0,0,0,.02));
border-radius:14px;padding:16px;border:1px solid rgba(255,255,255,.03);}
.section-title{font-size:28px}
.neu-btn{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(0,0,0,.06));
border-radius:10px;border:1px solid rgba(255,255,255,.04);
padding:10px 14px;color:#e6eef3;font-weight:700;cursor:pointer}
.neu-btn.secondary{opacity:.85}
.series-card{display:flex;justify-content:space-between;gap:12px;padding:14px;border-radius:12px;
background:linear-gradient(180deg,rgba(255,255,255,.015),rgba(0,0,0,.02));
border:1px solid rgba(255,255,255,.02)}
.right-controls{display:flex;gap:8px;flex-wrap:wrap}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.65);
display:flex;align-items:center;justify-content:center;z-index:9999}
.confirm-box{background:#0b1622;padding:22px;border-radius:12px;max-width:520px;width:92%}
</style>
</head>

<body>
<div class="wrap">
<header>
  <div class="logo">28</div>
  <h1>Bluff Masters</h1>
  <div style="flex:1"></div>
  <button class="neu-btn" onclick="showHome()">üè† Home</button>
</header>

<section id="homeSection" class="card">
  <div class="section-title">Active Series</div>
  <div id="activeList" style="margin-top:12px"></div>
</section>

<section id="statsSection" class="card" style="display:none;margin-top:18px"></section>
</div>

<div id="modalContainer"></div>

<script type="module">
/* ================= CONFIG ================= */
const SECRET_KEY = "zachariahrenji";
const STORAGE_KEY = "bluff_tracker_v1";
const TEAM_LIST = ["Bibin & Zach","Bimal & Annu","Bibin & Annu","Zach & Daddy"];

/* ================= STORAGE ================= */
let gameData = { games: [] };
const raw = localStorage.getItem(STORAGE_KEY);
if(raw) gameData = JSON.parse(raw);
function saveLocal(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(gameData)); }
function uid(){ return "s_"+Date.now()+"_"+Math.random().toString(36).slice(2); }
function esc(s){return s.replace(/[&<>"']/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[c]))}

/* ================= SERIES AGG ================= */
function computeSeries(){
  const map={};
  gameData.games.forEach(g=>{
    if(!map[g.seriesId]){
      map[g.seriesId]={id:g.seriesId,target:g.seriesTarget||5,
        teams:g.seriesTeams || {
          A:{members:g.winner.split("&").map(x=>x.trim())},
          B:{members:g.loser.split("&").map(x=>x.trim())}
        },
        wins:{}};
    }
    map[g.seriesId].wins[g.winner]=(map[g.seriesId].wins[g.winner]||0)+1;
  });
  return map;
}

/* ================= UI ================= */
function renderHome(){
  const list=document.getElementById("activeList");
  list.innerHTML="";
  const series=computeSeries();
  Object.values(series).forEach(s=>{
    const A=s.teams.A.members.join(" & ");
    const B=s.teams.B.members.join(" & ");
    const card=document.createElement("div");
    card.className="series-card";
    card.innerHTML=`
      <div><b>${esc(A)}</b> vs <b>${esc(B)}</b></div>
      <div class="right-controls">
        <button class="neu-btn secondary" onclick="editTeams('${s.id}')">‚úèÔ∏è Edit Teams</button>
      </div>`;
    list.appendChild(card);
  });
}

/* ================= MODALS ================= */
function closeModal(){document.getElementById("modalContainer").innerHTML=""}
function showModal(title,html,onOk){
  const o=document.createElement("div");o.className="overlay";
  const b=document.createElement("div");b.className="confirm-box";
  b.innerHTML=`<h3>${title}</h3>${html}
  <div style="margin-top:12px;text-align:center">
    <button class="neu-btn" id="okBtn">Save</button>
    <button class="neu-btn secondary" onclick="closeModal()">Cancel</button>
  </div>`;
  o.appendChild(b);document.getElementById("modalContainer").appendChild(o);
  document.getElementById("okBtn").onclick=onOk;
}

/* ================= EDIT TEAMS (PASSWORD) ================= */
window.editTeams=function(seriesId){
  const pw=prompt("Enter password to edit teams:");
  if(pw!==SECRET_KEY){ alert("‚ùå Incorrect password"); return; }

  const series=computeSeries()[seriesId];
  const A=series.teams.A.members.join(", ");
  const B=series.teams.B.members.join(", ");

  showModal("Edit Teams",`
    <label>Team A members</label>
    <input id="teamA" style="width:100%" value="${esc(A)}">
    <label style="margin-top:8px;display:block">Team B members</label>
    <input id="teamB" style="width:100%" value="${esc(B)}">
  `,()=>{
    const newA=document.getElementById("teamA").value.split(",").map(x=>x.trim()).filter(Boolean);
    const newB=document.getElementById("teamB").value.split(",").map(x=>x.trim()).filter(Boolean);
    if(!newA.length||!newB.length){alert("Teams cannot be empty");return;}

    gameData.games.forEach(g=>{
      if(g.seriesId===seriesId){
        g.seriesTeams={A:{members:newA},B:{members:newB}};
        g.winner = newA.join(" & ");
        g.loser = newB.join(" & ");
      }
    });
    saveLocal();
    closeModal();
    renderHome();
  });
};

/* ================= NAV ================= */
window.showHome=()=>{homeSection.style.display="block";statsSection.style.display="none"}
renderHome();
</script>
</body>
</html>
