<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bluff Masters</title>
<link rel="icon" href="blufffavicon.png" />
<style>
/* ===== ORIGINAL STYLES (UNCHANGED) ===== */
:root{
  --bg1:#061226;
  --bg2:#081b31;
  --card:#0e2336;
  --muted:#9fb7bf;
  --accent:#2ecc71;
  --gold:#ffd36d;
  --danger:#ff6b6b;
}
html,body{height:100%;margin:0;font-family:Inter,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:radial-gradient(circle at 10% 10%,var(--bg1),var(--bg2) 60%);color:#e6eef3;}
.wrap{max-width:1100px;margin:22px auto;padding:20px;}
.neu-btn{cursor:pointer}
</style>
</head>
<body>

<div class="wrap">
  <h1>Bluff Masters</h1>
  <button onclick="startNewSeries()">➕ New Series</button>
  <div id="activeList"></div>
</div>

<script type="module">
/* =====================================================
   SAFE SINGLE-FILE APP (FULLY INITIALIZED)
===================================================== */

/* ---------- CONFIG ---------- */
const SECRET_KEY = "zachariahrenji";
const STORAGE_KEY = "bluff_tracker_v1";
const TEAM_LIST = [
  "Bibin & Zach","Bimal & Annu","Bibin & Annu",
  "Zach & Daddy","Bibin & Bimal","Zach & Rikku","Bibin & Daddy"
];

/* ---------- DATA ---------- */
let gameData = { games: [] };

try{
  const raw = localStorage.getItem(STORAGE_KEY);
  if(raw) gameData = JSON.parse(raw);
}catch(e){}

function saveLocal(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(gameData));
}

function uid(){
  return "series_" + Date.now() + "_" + Math.floor(Math.random()*1000);
}

/* ---------- RENDER ---------- */
function renderHomeActiveList(){
  const list = document.getElementById("activeList");
  list.innerHTML = "";

  const seriesMap = {};
  gameData.games.forEach(g=>{
    if(!seriesMap[g.seriesId]){
      seriesMap[g.seriesId] = { games: [], target:g.seriesTarget };
    }
    if(!g._metaOnly) seriesMap[g.seriesId].games.push(g);
  });

  Object.keys(seriesMap).forEach(id=>{
    const s = seriesMap[id];
    const wins = {};
    s.games.forEach(g=> wins[g.winner]=(wins[g.winner]||0)+1);

    const teams = Object.keys(wins);
    const a = teams[0] || "—";
    const b = teams[1] || "—";
    const score = `${wins[a]||0} - ${wins[b]||0}`;

    const div = document.createElement("div");
    div.innerHTML = `
      <b>${a} vs ${b}</b> | ${score}
      <button onclick="openAddGame('${id}')">➕ Add</button>
      <button onclick="editSeriesTeams('${id}')">✏️ Edit</button>
    `;
    list.appendChild(div);
  });
}

/* ---------- START NEW SERIES (FIXED) ---------- */
window.startNewSeries = function(){
  const a = prompt("Team A (leave blank to choose from list):");
  const teamA = a || TEAM_LIST[0];
  const b = prompt("Team B (leave blank to choose from list):");
  const teamB = b || TEAM_LIST[1];

  if(teamA===teamB) return alert("Teams must differ");

  const sid = uid();
  gameData.games.push({
    seriesId:sid,
    seriesTarget:5,
    _metaOnly:true,
    time:new Date().toISOString()
  });
  saveLocal();
  renderHomeActiveList();
};

/* ---------- ADD GAME ---------- */
window.openAddGame = function(seriesId){
  const winner = prompt("Winner name:");
  const loser = prompt("Loser name:");
  if(!winner||!loser) return;

  gameData.games.push({
    seriesId,
    winner,
    loser,
    seriesTarget:5,
    time:new Date().toISOString()
  });
  saveLocal();
  renderHomeActiveList();
};

/* ---------- EDIT TEAMS ---------- */
window.editSeriesTeams = function(seriesId){
  const pw = prompt("Password:");
  if(pw!==SECRET_KEY) return alert("Wrong password");

  const games = gameData.games.filter(g=>g.seriesId===seriesId && !g._metaOnly);
  if(!games.length) return alert("No games yet");

  const names = [...new Set(games.flatMap(g=>[g.winner,g.loser]))];
  const updated = prompt("Edit teams (A,B)", names.join(","));
  if(!updated) return;

  const [A,B] = updated.split(",").map(x=>x.trim());
  games.forEach(g=>{
    g.winner = g.winner===names[0]?A:B;
    g.loser  = g.loser===names[0]?A:B;
  });
  saveLocal();
  renderHomeActiveList();
};

/* ---------- INIT ---------- */
renderHomeActiveList();
console.log("✅ App loaded safely");
</script>
</body>
</html>
